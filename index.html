<!-- https://aakash91762.github.io/someItemsAreMissing -->
<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link
      href="https://fonts.googleapis.com/css?family=Inter"
      rel="stylesheet"
    />
  </head>
  <body style="background-color: #eeeeee">
    <style>
      body {
        font-family: "Inter";
        text-align: center;
      }
      input {
        height: 2em;
        width: 20em;
        vertical-align: middle;
      }
      label {
        color: black;
      }
      p {
        text-align: justify;
      }
      .container {
        width: 95%;
        background-color: #eeeeee;
        font-size: 12px;
        text-align: left;
        /* text-align: center; */
      }
      .input {
        margin: 5px 0px;
        padding: 1px 10px;
        border: 1px solid #eeeeee;
        border-radius: 5px;
        outline: 0;
        height: 25px;
        width: 100%;
        font-size: 12px;
        /* background-color: #f5f5f5; */
        /* color: #666; */
      }
      .custom-select {
        margin: 5px 0px;
        padding: 5px 10px;
        border-radius: 5px;
        border: 1px solid #eeeeee;
        height: 30px;
        width: 100%;
        font-size: 12px;
        font-family: "Inter";
      }
      .input:focus {
        border: 1px solid #dd0150;
      }
      .custom-select:focus {
        border: 1px solid #dd0150;
      }
      .submit {
        background-color: #dd0150;
        padding: 15px;
        width: 100%;
        border-radius: 5px;
        font-size: 14px;
        font-weight: bold;
        border: none;
        color: white;
        height: 45px;
        margin-top: 4rem;
      }
      .submit:hover {
        background-color: #f74586;
      }
      .result {
        font-weight: bold;
        margin: 10px 0px 20px;
      }
      .checkbox-group {
        margin: 5px 0px;
        padding: 10px;
        border: 1px solid #eeeeee;
        border-radius: 5px;
        background-color: white;
        width: 100%;
        /* font-size: 10%; */
      }
      .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-width: 100%;
      }
      .checkbox-item {
        margin: 8px 0;
        display: flex;
        align-items: center;
      }
      .checkbox-item input[type="checkbox"] {
        width: auto;
        height: auto;
        margin-right: 8px;
      }
      .checkbox-item label {
        margin: 0;
        cursor: pointer;
        flex: 1;
      }
      .free-text {
        min-height: 2em;
        padding-top: 10px;
      }
      .radio-group {
        width: 100%;
        display: flex;
        flex-direction: column; /* stack vertically */
        gap: 8px; /* space between each option */
        margin: 5px 0;
        padding: 10px;
        border: 1px solid #eeeeee;
        border-radius: 5px;
        background-color: white;
        font-size: 12px; /* match form font size */
      }

      .radio-group label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        font-size: 12px; /* match form font size */
      }

      .radio-group input[type="radio"] {
        width: auto;
        height: auto;
        cursor: pointer;
      }
    </style>

    <center>
      <div class="container">
        <label id="header"></label> <br /><br />
        <form>
          <label id="lOrderNumber"></label><br />
          <input
            class="input"
            id="orderNumber"
            type="text"
            value=""
            name="orderNumber"
            required
            readonly
          />
          <div id="rOrderNumber" class="result"></div>

          <label id="lemail"></label> <br />
          <input
            class="input"
            id="email"
            type="email"
            value=""
            name="email"
            size="15"
            required
          />
          <div id="remail" class="result"></div>

          <label id="lIssue"></label><br />
          <input
            class="input"
            id="issue"
            type="text"
            value=""
            name="issue"
            required
            readonly
          />

          <div id="rIssue" class="result"></div>

          <label id="lChooseItem"></label><br />
          <div class="checkbox-group" id="itemCheckboxGroup"></div>
          <div id="rItems" class="result"></div>

          <!-- ✅ Radio Buttons -->
          <label id="lOption"></label><br />
          <div class="radio-group" id="radioGroup">
            <label
              ><input type="radio" name="option" value="1" required /> 1</label
            >
            <br />
            <label
              ><input type="radio" name="option" value="2" required /> 2</label
            >
            <br />
            <label
              ><input type="radio" name="option" value="others" required />
              Others</label
            >
          </div>
          <div id="rOption" class="result"></div>

          <label id="lDescription"></label><br />
          <input
            class="input"
            id="description"
            type="text"
            value=""
            name="description"
            required
          />
          <div id="rDescription" class="result"></div>

          <input
            type="hidden"
            id="language"
            name="language"
            value="en"
            required
          />
          <button id="submit" class="submit" type="submit"></button>
        </form>
      </div>
    </center>

    <script type="text/javascript">
      let params = new URLSearchParams(window.location.search);
      var language = params.get("language");
      var orderNumber = params.get("orderNumber");
      var issue = params.get("issue");
      var items = params.get("items");
      var description = params.get("description");
      var option = params.get("option"); // ✅ fetch radio from URL
      var email = params.get('email')


      document
        .getElementById("orderNumber")
        .setAttribute("value", orderNumber || "");
      document.getElementById("issue").setAttribute("value", issue || "");

      // ✅ Dynamic checkbox creation
      function createCheckboxes(values) {
        const container = document.getElementById("itemCheckboxGroup");
        container.innerHTML = "";
        values.forEach((value, index) => {
          const div = document.createElement("div");
          div.classList.add("checkbox-item");
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = "item" + index;
          checkbox.name = "items";
          checkbox.value = value;
          checkbox.checked = false;
          const label = document.createElement("label");
          label.setAttribute("for", "item" + index);
          label.textContent = value;
          div.appendChild(checkbox);
          div.appendChild(label);
          container.appendChild(div);
        });
      }

      const selectedFromUrl = params.get("selected")
        ? params.get("selected").split(",")
        : [];
      createCheckboxes(selectedFromUrl);

      // ✅ Populate view mode if already submitted
      if (orderNumber && issue && items && description && option) {
        let o = document.getElementById("orderNumber");
        let i = document.getElementById("issue");
        let checkboxGroup = document.getElementById("itemCheckboxGroup");
        let d = document.getElementById("description");
        let s = document.getElementById("submit");
        let r = document.getElementById("radioGroup");
        let e = document.getElementById("email");

        o.setAttribute("type", "hidden");
        i.hidden = true;
        checkboxGroup.hidden = true;
        d.hidden = true;
        s.style.visibility = "hidden";
        r.hidden = true;
        e.hidden = true;

        document.getElementById("rOrderNumber").innerHTML = orderNumber;
        document.getElementById("remail").innerHTML = email;
        document.getElementById("rIssue").innerHTML = issue;
        document.getElementById("rItems").innerHTML = items.replace(/,/g, ", ");
        document.getElementById("rDescription").innerHTML = description;
        document.getElementById("rOption").innerHTML = option;
      }

      // ✅ Language setup
      if (language == "id") {
        document.getElementById("header").innerHTML =
          "Lengkapi informasi berikut untuk melaporkan masalah.";
        document.getElementById("lOrderNumber").innerHTML = "Nomor Pesanan:";
        document.getElementById("lemail").placeholder = "Email Aktif";
        document.getElementById("lemail").innerHTML = "Email Aktif:";
        document.getElementById("lIssue").innerHTML = "Masalah:";
        document.getElementById("lChooseItem").innerHTML =
          "Pilih Barang yang Bermasalah:";
        document.getElementById("lOption").innerHTML = "Jumlah yang Diterima:";
        document.getElementById("lDescription").innerHTML = "Jelaskan Masalah:";
        document.getElementById("description").placeholder = "Jelaskan Masalah";
        document.getElementById("submit").innerHTML = "Kirim";
        document.getElementById("language").setAttribute("value", "id");
      } else {
        document.getElementById("header").innerHTML =
          "Please share the following information to report an issue.";
        document.getElementById("lOrderNumber").innerHTML = "Order Number:";
        document.getElementById("lemail").innerHTML = "Active Email ID:";
        document.getElementById("email").placeholder = "Active Email ID";
        document.getElementById("lIssue").innerHTML = "Issue:";
        document.getElementById("lChooseItem").innerHTML =
          "Choose the item with an issue:";
        document.getElementById("lOption").innerHTML =
          "How many did you receive?";
        document.getElementById("lDescription").innerHTML =
          "Tell us what’s going on:";
        document.getElementById("description").placeholder =
          "Tell us what’s going on";
        document.getElementById("submit").innerHTML = "Submit";
        document.getElementById("language").setAttribute("value", "en");
      }

      // ✅ Form submit handler
      document.querySelector("form").addEventListener("submit", function (e) {
        e.preventDefault();

        const orderNum = document.getElementById("orderNumber").value;
        const selectedIssue = document.getElementById("issue").value;
        const checkboxes = document.querySelectorAll(
          'input[name="items"]:checked'
        );
        const selectedItems = Array.from(checkboxes).map((cb) => cb.value);
        const problemDescription = document
          .getElementById("description")
          .value.trim();
        const selectedOption = document.querySelector(
          'input[name="option"]:checked'
        );

        if (selectedItems.length === 0) {
          alert(
            language === "id"
              ? "Silakan pilih minimal satu item"
              : "Please select at least one item"
          );
          return;
        }
        if (!selectedOption) {
          alert(
            language === "id"
              ? "Silakan pilih satu opsi"
              : "Please select an option"
          );
          return;
        }

        const urlParams = new URLSearchParams();
        urlParams.set("orderNumber", orderNum);
        const emailValue = document.getElementById("email").value.trim();
        urlParams.set("email", emailValue);
        urlParams.set("issue", selectedIssue);
        urlParams.set("items", selectedItems.join(","));
        urlParams.set("description", problemDescription);
        urlParams.set("language", language);
        urlParams.set("option", selectedOption.value);

        const newUrl = window.location.pathname + "?" + urlParams.toString();
        window.history.pushState({}, "", newUrl);

        const sendData = {
          orderNumber: orderNum,
          email: emailValue,
          issue: selectedIssue,
          items: selectedItems,
          description: problemDescription,
          option: selectedOption.value,
        };

        myFunction(sendData);
      });

      function myFunction(sendData) {
        console.log(sendData);
        let data = JSON.stringify(sendData);

        document.getElementById("orderNumber").setAttribute("type", "hidden");
        document.getElementById("email").setAttribute("type", "hidden");
        document.getElementById("issue").hidden = true;
        document.getElementById("itemCheckboxGroup").hidden = true;
        document.getElementById("description").hidden = true;
        document.getElementById("submit").style.visibility = "hidden";
        document.getElementById("radioGroup").hidden = true;

        document.getElementById("rOrderNumber").innerHTML =
          sendData.orderNumber;
        document.getElementById("remail").innerHTML = sendData.email;
        document.getElementById("rIssue").innerHTML = sendData.issue;
        document.getElementById("rItems").innerHTML = sendData.items.join(", ");
        document.getElementById("rDescription").innerHTML =
          sendData.description;
        document.getElementById("rOption").innerHTML = sendData.option;

        window.parent.postMessage(
          JSON.stringify({
            event_code: "ym-client-event",
            data: JSON.stringify({
              event: { code: new Date().getTime().toString(), data },
            }),
          }),
          "*"
        );
        console.log(
          JSON.stringify({
            event_code: "ym-client-event",
            data: JSON.stringify({
              event: {
                code: new Date().getTime().toString(),
                data,
              },
            }),
          })
        );
      }
    </script>
  </body>
</html>
